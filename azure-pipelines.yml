# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

jobs:
- job: Build_LibGit2
  timeoutInMinutes: 0
  pool:
    vmImage: macOS-10.15

  steps:

  - script: ./build-tools.sh
    displayName: 'Build autoconf, automake and libtool for local use'
    enabled: false

  - publish: $(System.DefaultWorkingDirectory)/tools.tar.xz
    artifact: BuildTools
    displayName: 'Publish auto build tools'
    enabled: false

  - script: ./build-libgit2-framework.sh
    displayName: 'Build LibGit2 Framework from Source'
    continueOnError: false
    enabled: true

  - script: ./compute-checksum.sh
    displayName: 'Compute checksum'
    enabled: false

  - publish: $(System.DefaultWorkingDirectory)/libgit2.xcframework
    artifact: libgit2.xcframework
    displayName: 'Publish libgit2 XCFramework'
    enabled: true

  - publish: $(System.DefaultWorkingDirectory)/libpcre.xcframework
    artifact: libpcre.xcframework
    displayName: 'Publish libpcre XCFramework'
    enabled: true

  - publish: $(System.DefaultWorkingDirectory)/openssl.xcframework
    artifact: openssl.xcframework
    displayName: 'Publish openssl XCFramework'
    enabled: true

  - publish: $(System.DefaultWorkingDirectory)/libssh2.xcframework
    artifact: libssh2.xcframework
    displayName: 'Publish libssh2 XCFramework'
    enabled: true

  - publish: $(System.DefaultWorkingDirectory)/install
    artifact: install
    displayName: 'Publish all install files for inspection'
    enabled: false

  - publish: $(System.DefaultWorkingDirectory)
    artifact: AllFiles
    displayName: 'Publish all files for inspection'
    enabled: false
